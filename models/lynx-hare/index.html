<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel="shortcut icon" type="image/png" href="/TuringModels.jl/assets/favicon.png"/> <link rel=stylesheet  href="/TuringModels.jl/libs/katex/katex.min.css"> <link rel=stylesheet  href="/TuringModels.jl/libs/highlight/github.min.css"> <link rel=stylesheet  href="/TuringModels.jl/css/franklin.css"> <title>Lynx and hare populations</title> <div class=franklin-content > <div class=top-bar > <a href="/TuringModels.jl/">TuringModels</a> </div> <h1>Lynx and hare populations</h1> </div> <div class=franklin-content > <p>The last model in the 2nd edition of the Statistical Rethinking book is a time series model of hare and lynx populations. The model below is based on the book and the <a href="https://turing.ml">Turing.jl tutorials</a>. The main differences with the Turing tutorial are that below we use Gadfly for plotting and that the Turing tutorial has more explanation.</p> <p>In the book, the model, <code>m16.5</code>, is defined around page 547 as</p> <span class=katex-display ><span class=katex ><span class=katex-mathml ><math xmlns="http://www.w3.org/1998/Math/MathML" display=block ><semantics><mtable rowspacing=0.24999999999999992em  columnalign="right left right" columnspacing="0em 1em"><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi>σ</mi><mi>H</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>∼</mo><mtext>Exponential</mtext><mo stretchy=false >(</mo><mn>1</mn><mo stretchy=false >)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mtext>[Prior for measurement dispersion]</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi>σ</mi><mi>L</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>∼</mo><mtext>Exponential</mtext><mo stretchy=false >(</mo><mn>1</mn><mo stretchy=false >)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mtext>[Prior for measurement dispersion]</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi>p</mi><mi>H</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>∼</mo><mtext>Beta</mtext><mo stretchy=false >(</mo><msub><mi>α</mi><mi>H</mi></msub><mo separator=true >,</mo><msub><mi>β</mi><mi>H</mi></msub><mo stretchy=false >)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mtext>[Prior for hare trap probability]</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi>p</mi><mi>L</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>∼</mo><mtext>Beta</mtext><mo stretchy=false >(</mo><msub><mi>α</mi><mi>L</mi></msub><mo separator=true >,</mo><msub><mi>β</mi><mi>L</mi></msub><mo stretchy=false >)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mtext>[Prior for lynx trap probability]</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi>b</mi><mi>H</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>∼</mo><mtext>Half-Normal</mtext><mo stretchy=false >(</mo><mn>1</mn><mo separator=true >,</mo><mn>0.5</mn><mo stretchy=false >)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mtext>[Prior hare birth rate]</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi>b</mi><mi>L</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>∼</mo><mtext>Half-Normal</mtext><mo stretchy=false >(</mo><mn>0.05</mn><mo separator=true >,</mo><mn>0.05</mn><mo stretchy=false >)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mtext>[Prior lynx birth rate]</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi>m</mi><mi>H</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>∼</mo><mtext>Half-Normal</mtext><mo stretchy=false >(</mo><mn>0.05</mn><mo separator=true >,</mo><mn>0.05</mn><mo stretchy=false >)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mtext>[Prior hare mortality rate]</mtext></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel=0  displaystyle=true ><msub><mi>m</mi><mi>L</mi></msub></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mrow><mrow></mrow><mo>∼</mo><mtext>Half-Normal</mtext><mo stretchy=false >(</mo><mn>1</mn><mo separator=true >,</mo><mn>0.05</mn><mo stretchy=false >)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel=0  displaystyle=true ><mtext>[Prior lynx mortality rate]</mtext></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex"> \begin{aligned} \sigma_H &amp;\sim \text{Exponential}(1) &amp; \text{[Prior for measurement dispersion]} \\ \sigma_L &amp;\sim \text{Exponential}(1) &amp; \text{[Prior for measurement dispersion]} \\ p_H &amp;\sim \text{Beta}(\alpha_H, \beta_H) &amp; \text{[Prior for hare trap probability]} \\ p_L &amp;\sim \text{Beta}(\alpha_L, \beta_L) &amp; \text{[Prior for lynx trap probability]} \\ b_H &amp;\sim \text{Half-Normal}(1, 0.5) &amp; \text{[Prior hare birth rate]} \\ b_L &amp;\sim \text{Half-Normal}(0.05, 0.05) &amp; \text{[Prior lynx birth rate]} \\ m_H &amp;\sim \text{Half-Normal}(0.05, 0.05) &amp; \text{[Prior hare mortality rate]} \\ m_L &amp;\sim \text{Half-Normal}(1, 0.05) &amp; \text{[Prior lynx mortality rate]} \end{aligned} </annotation></semantics></math></span><span class=katex-html  aria-hidden=true ><span class=base ><span class=strut  style="height:12.000000000000002em;vertical-align:-5.750000000000001em;"></span><span class=mord ><span class=mtable ><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:6.250000000000001em;"><span style="top:-8.41em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-6.91em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal" style="margin-right:0.03588em;">σ</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-5.409999999999999em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.9099999999999993em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">p</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999993em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">b</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:-0.9099999999999988em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">b</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:0.5900000000000007em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span><span style="top:2.0900000000000007em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ><span class="mord mathnormal">m</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:5.750000000000001em;"><span></span></span></span></span></span><span class=col-align-l ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:6.250000000000001em;"><span style="top:-8.41em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class=mord >Exponential</span></span><span class=mopen >(</span><span class=mord >1</span><span class=mclose >)</span></span></span><span style="top:-6.91em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class=mord >Exponential</span></span><span class=mopen >(</span><span class=mord >1</span><span class=mclose >)</span></span></span><span style="top:-5.409999999999999em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class=mord >Beta</span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:0.08125em;">H</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span><span style="top:-3.9099999999999993em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class=mord >Beta</span></span><span class=mopen >(</span><span class=mord ><span class="mord mathnormal" style="margin-right:0.0037em;">α</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.0037em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord ><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class=msupsub ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:0.32833099999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.05278em;margin-right:0.05em;"><span class=pstrut  style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">L</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:0.15em;"><span></span></span></span></span></span></span><span class=mclose >)</span></span></span><span style="top:-2.4099999999999993em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class=mord >Half-Normal</span></span><span class=mopen >(</span><span class=mord >1</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >0</span><span class=mord >.</span><span class=mord >5</span><span class=mclose >)</span></span></span><span style="top:-0.9099999999999988em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class=mord >Half-Normal</span></span><span class=mopen >(</span><span class=mord >0</span><span class=mord >.</span><span class=mord >0</span><span class=mord >5</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >0</span><span class=mord >.</span><span class=mord >0</span><span class=mord >5</span><span class=mclose >)</span></span></span><span style="top:0.5900000000000007em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class=mord >Half-Normal</span></span><span class=mopen >(</span><span class=mord >0</span><span class=mord >.</span><span class=mord >0</span><span class=mord >5</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >0</span><span class=mord >.</span><span class=mord >0</span><span class=mord >5</span><span class=mclose >)</span></span></span><span style="top:2.0900000000000007em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class=mord ></span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class=mrel >∼</span><span class=mspace  style="margin-right:0.2777777777777778em;"></span><span class="mord text"><span class=mord >Half-Normal</span></span><span class=mopen >(</span><span class=mord >1</span><span class=mpunct >,</span><span class=mspace  style="margin-right:0.16666666666666666em;"></span><span class=mord >0</span><span class=mord >.</span><span class=mord >0</span><span class=mord >5</span><span class=mclose >)</span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:5.750000000000001em;"><span></span></span></span></span></span><span class=arraycolsep  style="width:1em;"></span><span class=col-align-r ><span class="vlist-t vlist-t2"><span class=vlist-r ><span class=vlist  style="height:6.250000000000001em;"><span style="top:-8.41em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >[Prior for measurement dispersion]</span></span></span></span><span style="top:-6.91em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >[Prior for measurement dispersion]</span></span></span></span><span style="top:-5.409999999999999em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >[Prior for hare trap probability]</span></span></span></span><span style="top:-3.9099999999999993em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >[Prior for lynx trap probability]</span></span></span></span><span style="top:-2.4099999999999993em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >[Prior hare birth rate]</span></span></span></span><span style="top:-0.9099999999999988em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >[Prior lynx birth rate]</span></span></span></span><span style="top:0.5900000000000007em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >[Prior hare mortality rate]</span></span></span></span><span style="top:2.0900000000000007em;"><span class=pstrut  style="height:3em;"></span><span class=mord ><span class="mord text"><span class=mord >[Prior lynx mortality rate]</span></span></span></span></span><span class=vlist-s >​</span></span><span class=vlist-r ><span class=vlist  style="height:5.750000000000001em;"><span></span></span></span></span></span></span></span></span></span></span></span> <h2 id=data ><a href="#data" class=header-anchor >Data</a></h2> <pre><code class=language-julia >using DataFrames
using DifferentialEquations
using Gadfly</code></pre> <p>First, we simulate population dynamics with the Lotka-Volterra model.</p> <pre><code class=language-julia >function lotka_volterra&#40;du, u, p, t&#41;
  x, y &#61; u
  α, β, γ, δ &#61; p
  du&#91;1&#93; &#61; &#40;α - β*y&#41;x
  du&#91;2&#93; &#61; &#40;δ*x - γ&#41;y
end

p &#61; &#91;1.5, 1.0, 3.0, 1.0&#93;
u0 &#61; &#91;1.0, 1.0&#93;
prob1 &#61; ODEProblem&#40;lotka_volterra, u0, &#40;0.0, 10.0&#41;, p&#41;
sol &#61; solve&#40;prob1, Tsit5&#40;&#41;; saveat&#61;0.1&#41;</code></pre> <p>To plot it, we convert the data to a DataFrame first</p> <pre><code class=language-julia >function data2df&#40;time, hare, lynx; index&#61;1&#41;
    df &#61; DataFrame&#40;
        time &#61; time,
        hare &#61; hare,
        lynx &#61; lynx
    &#41;
    sdf &#61; stack&#40;df, &#91;:hare, :lynx&#93;; variable_name&#61;:group, value_name&#61;:number&#41;
    sdf&#91;&#33;, :index&#93; .&#61; index
    sdf
end

timesteps &#61; 1:length&#40;sol&#41;
time &#61; sol.t&#91;timesteps&#93;
hare &#61; sol&#91;1, timesteps&#93;
lynx &#61; sol&#91;2, timesteps&#93;

df_original &#61; data2df&#40;time, hare, lynx&#41;
plot&#40;df_original, x&#61;:time, y&#61;:number, color&#61;:group,
    Geom.point, Geom.smooth&#40;method&#61;:loess, smoothing&#61;0.2&#41;&#41;</code></pre> <img src="/TuringModels.jl/assets/models/lynx-hare/code/data.svg" alt=""> <p>To make the data more realistic, the example from the Turing tutorials adds random noise:</p> <pre><code class=language-julia >sol_noise &#61; solve&#40;prob1, Tsit5&#40;&#41;; saveat&#61;0.1&#41;
odedata &#61; Array&#40;sol_noise&#41; &#43; 0.8 * randn&#40;size&#40;Array&#40;sol_noise&#41;&#41;&#41;

time &#61; sol_noise.t&#91;timesteps&#93;
hare &#61; odedata&#91;1, :&#93;
lynx &#61; odedata&#91;2, :&#93;
df_noise &#61; data2df&#40;time, hare, lynx&#41;

plot&#40;df_noise, x&#61;:time, y&#61;:number, color&#61;:group,
    Geom.point, Geom.smooth&#40;method&#61;:loess, smoothing&#61;0.2&#41;&#41;</code></pre> <img src="/TuringModels.jl/assets/models/lynx-hare/code/data_noise.svg" alt=""> <h2 id=model ><a href="#model" class=header-anchor >Model</a></h2> <pre><code class=language-julia >using CategoricalArrays
using Turing
Turing.setadbackend&#40;:forwarddiff&#41;

@model function fitlv&#40;data, prob1&#41;
    σ ~ InverseGamma&#40;2, 3&#41;
    α ~ truncated&#40;Normal&#40;1.5, 0.5&#41;, 0.5, 2.5&#41;
    β ~ truncated&#40;Normal&#40;1.2, 0.5&#41;, 0, 2&#41;
    γ ~ truncated&#40;Normal&#40;3.0, 0.5&#41;, 1, 4&#41;
    δ ~ truncated&#40;Normal&#40;1.0, 0.5&#41;, 0, 2&#41;

    p &#61; &#91;α, β, γ, δ&#93;
    prob &#61; remake&#40;prob1; p&#41;
    predicted &#61; solve&#40;prob, Tsit5&#40;&#41;; saveat&#61;0.1&#41;

    for i &#61; 1:length&#40;predicted&#41;
        data&#91;:,i&#93; ~ MvNormal&#40;predicted&#91;i&#93;, σ&#41;
    end
end

model &#61; fitlv&#40;odedata, prob1&#41;;</code></pre> <h2 id=output ><a href="#output" class=header-anchor >Output</a></h2> <pre><code class=language-julia >chns &#61; sample&#40;model, NUTS&#40;&#41;, MCMCThreads&#40;&#41;, 1000, 3&#41;</code></pre><pre><code class=plaintext >Chains MCMC chain (1000×17×3 Array{Float64, 3}):

Iterations        = 501:1:1500
Number of chains  = 3
Samples per chain = 1000
Wall duration     = 43.21 seconds
Compute duration  = 42.27 seconds
parameters        = α, γ, σ, δ, β
internals         = lp, n_steps, is_accept, acceptance_rate, log_density, hamiltonian_energy, hamiltonian_energy_error, max_hamiltonian_energy_error, tree_depth, numerical_error, step_size, nom_step_size

Summary Statistics
  parameters      mean       std   naive_se      mcse         ess      rhat   ess_per_sec
      Symbol   Float64   Float64    Float64   Float64     Float64   Float64       Float64

           σ    0.8114    0.0411     0.0008    0.0009   1617.4337    1.0005       38.2652
           α    1.4376    0.0467     0.0009    0.0020    585.3334    1.0054       13.8478
           β    0.9594    0.0423     0.0008    0.0016    633.6216    1.0034       14.9902
           γ    3.1979    0.1546     0.0028    0.0066    612.2857    1.0054       14.4855
           δ    1.0591    0.0564     0.0010    0.0024    606.8771    1.0046       14.3575

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           σ    0.7379    0.7826    0.8084    0.8377    0.8981
           α    1.3516    1.4051    1.4358    1.4678    1.5345
           β    0.8817    0.9306    0.9580    0.9858    1.0470
           γ    2.8990    3.0959    3.1964    3.2996    3.5041
           δ    0.9502    1.0211    1.0580    1.0960    1.1730
</code></pre> </p> <pre><code class=language-julia >TuringModels.gadfly_plot&#40;chns&#41;</code></pre>
<p> <img src="/TuringModels.jl/assets/models/lynx-hare/code/output/chns.svg" alt="">
<p>We can verify the outcome by retrodicting, that is, comparing the predictions with the true values. Similar to the Turing tutorial, we do this with some randomly picked posterior samples.</p>
<pre><code class=language-julia >function posterior_sol&#40;index&#41;
    posterior_p_subset &#61; Array&#40;chns&#41;&#91;rand&#40;1:1500&#41;, 1:4&#93;
    prob &#61; remake&#40;prob1; p&#61;posterior_p_subset&#41;
    retro_sol &#61; solve&#40;prob, Tsit5&#40;&#41;; saveat&#61;0.1&#41;
    timesteps &#61; 1:length&#40;retro_sol&#41;

    time &#61; retro_sol.t&#91;timesteps&#93;
    hare &#61; retro_sol&#91;1, timesteps&#93;
    lynx &#61; retro_sol&#91;2, timesteps&#93;
    data2df&#40;time, hare, lynx; index&#41;
end

samples &#61; 1:100
dfs &#61; posterior_sol.&#40;samples&#41;
df_retro &#61; vcat&#40;dfs...&#41;

df_retro.index &#61; categorical&#40;df_retro.index&#41;
hare_samples &#61; filter&#40;:group &#61;&gt; &#61;&#61;&#40;&quot;hare&quot;&#41;, df_retro&#41;
lynx_samples &#61; filter&#40;:group &#61;&gt; &#61;&#61;&#40;&quot;lynx&quot;&#41;, df_retro&#41;

plot&#40;
    layer&#40;hare_samples, x&#61;:time, y&#61;:number, color&#61;:index,
        Geom.smooth&#40;method&#61;:loess, smoothing&#61;0.2&#41;,
        Theme&#40;; line_width&#61;0.1mm, alphas&#61;&#91;0.3&#93;&#41;
    &#41;,
    layer&#40;lynx_samples, x&#61;:time, y&#61;:number, color&#61;:index,
        Geom.smooth&#40;method&#61;:loess, smoothing&#61;0.2&#41;,
        Theme&#40;; line_width&#61;0.1mm, alphas&#61;&#91;0.3&#93;&#41;
    &#41;,
    layer&#40;df_original, x&#61;:time, y&#61;:number, color&#61;:group,
        Geom.point, Geom.smooth&#40;method&#61;:loess, smoothing&#61;0.2&#41;
    &#41;,
    Theme&#40;; key_position&#61;:none&#41;
&#41;</code></pre>
<img src="/TuringModels.jl/assets/models/lynx-hare/code/output/retrofitted.svg" alt="">
<p>This is where the Statistical Rethinking books ends, for an example of handling missing data, see the Turing tutorials.</p>

<div class=page-foot >
  <div class=copyright >
    <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>
    Rob Goedman, Richard Torkar, Rik Huijzer, Martin Trapp and contributors. Last modified: July 20, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>.
  </div>
</div>
</div>
    
        



    
    
        <script src="/TuringModels.jl/libs/highlight/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();hljs.configure({tabReplace: '    '});</script>